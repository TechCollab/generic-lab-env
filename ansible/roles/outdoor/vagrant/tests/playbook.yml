---
- name: System update 
  hosts: all
  become: true
  gather_facts: true
  tasks:

    - name: Upgrade all packages
      yum: name=* state=latest
      notify: 
        - Restart system after upgrade
        - Waiting for server to come back

  handlers:
    - name: Restart system after upgrade
      shell: sleep 2 && hutdown -r now "Ansible updates triggered"
      async: 1
      poll: 0
      ignore_errors: true

    - name: Waiting for server to come back
      local_action: > 
        wait_for host={{ inventory_hostname }} 
        state=started 
        delay=30 
        timeout=300

- name: Setup for vagrant boxes
  hosts: all
  become: true
  gather_facts: true
#  vars:
#    freebsd_install_from_ports: True
  roles:
    - ansible-role-vagrant

#  tasks:
#    - name: bring up VM
#      shell: vagrant init centos/7; vagrant up --provider virtualbox
